<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>备考 CKA 过程，CKA 真题 | bits-pieces</title><link rel=icon href=/bits-pieces/favicon/favicon-32x32.png type=image/x-icon><link rel=stylesheet href=/bits-pieces/main.min.css media=screen><link rel=stylesheet href=/bits-pieces/custom.css media=screen></head><body><div class=wrapper><input type=checkbox class=hidden id=menu-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control><svg class="icon menu"><use xlink:href="#menu"/></svg><svg class="icon arrow-back"><use xlink:href="#arrow_back"/></svg></label><a class=gdoc-header__link href=https://l10178.github.io/bits-pieces/><span class="gdoc-brand flex align-center"><img class=gdoc-brand__img src=/bits-pieces/images/logos/logo.png alt=bits-pieces width=38 height=38>
bits-pieces</span></a></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class=gdoc-search><svg class="icon search"><use xlink:href="#search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/ class=gdoc-nav__entry>DevOps</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/mysql5.7to8.0/ class=gdoc-nav__entry>MySQL5.7升级至8.0</a></span></li><li><span class=flex><a href=/bits-pieces/devops/mysql-large-import/ class=gdoc-nav__entry>MySQL大文件导入优化</a></span></li><li><span class=flex><a href=/bits-pieces/devops/nexus/ class=gdoc-nav__entry>Nexus3 批量导入</a></span></li><li><span class=flex><a href=/bits-pieces/devops/superset/ class=gdoc-nav__entry>Superset 对接 ClickHouse</a></span></li><li><span class=flex><a href=/bits-pieces/devops/cdr/ class=gdoc-nav__entry>使用Visual Studio Code搭建多用户远程IDE</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/java/ class=gdoc-nav__entry>Java</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/java/jvm/ class=gdoc-nav__entry>Java进程内存分析</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-start-site/ class=gdoc-nav__entry>Spring Start脚手架快速入门</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-boot/ class=gdoc-nav__entry>从Spring到Spring Boot</a></span></li></ul></li><li><span class=flex>Kubernetes</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/kubernetes/envoy/ class=gdoc-nav__entry>Envoy生产配置最佳实践</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/cka/ class="gdoc-nav__entry is-active">备考 CKA 过程，CKA 真题</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/linux/ class=gdoc-nav__entry>Linux</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/linux/regular-expressions/ class=gdoc-nav__entry>Regular Expressions</a></span></li><li><span class=flex><a href=/bits-pieces/linux/git/ class=gdoc-nav__entry>Git常用配置</a></span></li><li><span class=flex><a href=/bits-pieces/linux/history/ class=gdoc-nav__entry>History入门</a></span></li><li><span class=flex><a href=/bits-pieces/linux/pngquant/ class=gdoc-nav__entry>PNG图片批量压缩</a></span></li><li><span class=flex><a href=/bits-pieces/linux/shell-coding/ class=gdoc-nav__entry>Shell 编程实用句式</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tcpdump/ class=gdoc-nav__entry>tcpdump</a></span></li><li><span class=flex><a href=/bits-pieces/linux/transaction/ class=gdoc-nav__entry>数据库事务控制</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tar.gz/ class=gdoc-nav__entry>文件压缩解压</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/windows/ class=gdoc-nav__entry>Windows</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/windows/takeown/ class=gdoc-nav__entry>Windows提权 + 设置环境变量</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/knives/ class=gdoc-nav__entry>瑞士军刀</a></span></li></ul></section><section class=gdoc-nav--more><h2>More</h2><ul class=gdoc-nav__list><li><span class=flex><svg class="icon download"><use xlink:href="#download"/></svg><a href=https://github.com/l10178/bits-pieces/releases class=gdoc-nav__entry>Releases</a></span></li><li><span class=flex><svg class="icon github"><use xlink:href="#github"/></svg><a href=https://github.com/l10178/bits-pieces class=gdoc-nav__entry>View Source</a></span></li></ul></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype=https://schema.org/Breadcrumb><span></span><span><svg class="icon code"><use xlink:href="#code"/></svg><a href=https://github.com/l10178/bits-pieces/edit/main/content/kubernetes/cka.md>Edit this page</a></span></div><article class=gdoc-markdown><h1>备考 CKA 过程，CKA 真题</h1><p>备考 CKA （Certified Kubernetes Administrator）过程，心得，遇见问题，CKA 真题。</p><div class=gdoc-page__anchorwrap><h2 id=备考环境>备考环境<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#备考环境 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 备考环境" href=#备考环境><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>备考使用的系统和软件版本如下。</p><ul><li>Ubuntu：20.04 Focal Fossa</li><li>Kubernetes：1.20.7</li><li>kubeadm：1.20.7</li></ul><div class=gdoc-page__anchorwrap><h2 id=安装和使用问题记录>安装和使用问题记录<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#安装和使用问题记录 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 安装和使用问题记录" href=#安装和使用问题记录><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><div class=gdoc-page__anchorwrap><h3 id=kubeadm-安装问题>kubeadm 安装问题<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#kubeadm-安装问题 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor kubeadm 安装问题" href=#kubeadm-安装问题><svg class="icon link"><use xlink:href="#link"/></svg></a></h3></div><p>安装 kubeadm，国内安装使用阿里镜像源。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cat /etc/apt/sources.list.d/kubernetes.list
</span></span><span class=line><span class=cl><span class=go>deb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main
</span></span></span></code></pre></div><p>踩坑：因为使用的是 ubuntu 20.04，代号 <code>focal</code>，专门去各个代理镜像源找<code>kubernetes-focal</code>都没有找到，后来发现 google 官方根本没发布对应的版本，只有<code>kubernetes-xenial</code>， k8s 官方文档里 ubuntu 也是用的这一个版本。可以用，就用他吧。</p><p>kubeadm init 时指定使用阿里镜像源（解决国内连不上 k8s.gcr.io 的问题）、指定版本号(安装考试对应的版本，不一定是最新版本)。<br>通过指定<code>--image-repository</code>，不需要手动下载镜像重新打 tag，kubeadm 自动使用指定的 repository。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubeadm init --image-repository<span class=o>=</span>registry.aliyuncs.com/google_containers <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --pod-network-cidr<span class=o>=</span>10.244.0.0/16 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --kubernetes-version<span class=o>=</span>v1.20.7
</span></span></code></pre></div><div class=gdoc-page__anchorwrap><h3 id=解决-scheduler-unhealthycontroller-manager-unhealthy>解决 scheduler Unhealthy，controller-manager Unhealthy<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#解决-scheduler-unhealthycontroller-manager-unhealthy class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 解决 scheduler Unhealthy，controller-manager Unhealthy" href=#解决-scheduler-unhealthycontroller-manager-unhealthy><svg class="icon link"><use xlink:href="#link"/></svg></a></h3></div><p>第一次安装完成后通过 <code>kubectl get cs</code>命令，发现 scheduler Unhealthy，controller-manager Unhealthy。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> kubectl get cs
</span></span><span class=line><span class=cl><span class=go>NAME                 STATUS      MESSAGE
</span></span></span><span class=line><span class=cl><span class=go>scheduler            Unhealthy   Get &#34;http://127.0.0.1:10251/healthz&#34;: dial tcp 127.0.0.1:10
</span></span></span><span class=line><span class=cl><span class=go>controller-manager   Unhealthy   Get &#34;http://127.0.0.1:10252/healthz&#34;: dial tcp 127.0.0.1:10
</span></span></span></code></pre></div><p>查看本机端口，10251 和 10252 都没有启动。</p><p>确认 schedule 和 controller-manager 组件配置是否禁用了非安全端口。</p><p>查看配置文件，路径分别为：<code>/etc/kubernetes/manifests/kube-scheduler.yaml</code> 和 <code>/etc/kubernetes/manifests/kube-controller-manager.yaml</code>
将两个配置文件中 <code>--port=0</code> 注释掉（注释掉是否合适待商量）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>command</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=l>kube-scheduler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- --<span class=l>authentication-kubeconfig=/etc/kubernetes/scheduler.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- --<span class=l>authorization-kubeconfig=/etc/kubernetes/scheduler.conf</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- --<span class=l>bind-address=127.0.0.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c># 注释掉port，其他行原样不要动</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- --<span class=l>port=0</span><span class=w>
</span></span></span></code></pre></div><div class=gdoc-page__anchorwrap><h3 id=解决-master-无法调度>解决 master 无法调度<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#解决-master-无法调度 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 解决 master 无法调度" href=#解决-master-无法调度><svg class="icon link"><use xlink:href="#link"/></svg></a></h3></div><p>我的环境是单节点，既当 master 又当 worker，kubeadm 安装完成后默认 master 节点是不参与调度的，pod 会一直 pending。</p><p>kubectl describe node 发现 node 的 Taints 里有 <code>node-role.kubernetes.io/master:NoSchedule</code>。</p><p>设置 k8s master 节点参与 POD 调度。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>kubectl taint nodes your-node-name node-role.kubernetes.io/master-
</span></span></code></pre></div><div class=gdoc-page__anchorwrap><h2 id=考试心得>考试心得<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#考试心得 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 考试心得" href=#考试心得><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><ul><li><p>刷新浏览器会导致考试被终止。</p></li><li><p>提前演练敲一遍，时间其实挺紧张。</p></li><li><p>官方<code>kubectl Cheat Sheet</code>章节非常有用，必考。</p></li><li><p>命令自动补全 source &lt;(kubectl completion bash)。</p></li><li><p>尽量使用命令创建 Pod、deployment、service。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>kubectl run podname --image=imagename --restart=Never -n namespace
</span></span></span><span class=line><span class=cl><span class=go>kubectl run &lt;deploymentname&gt; --image=&lt;imagename&gt; -n &lt;namespace&gt;
</span></span></span><span class=line><span class=cl><span class=go>kubectl expose &lt;deploymentname&gt; --port=&lt;portNo.&gt; --name=&lt;svcname&gt;
</span></span></span></code></pre></div></li><li><p>使用 dry-run。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>kubectl run &lt;podname&gt; --image=&lt;imagename&gt; --restart=Never --dry-run -o yaml &gt; title.yaml
</span></span></span></code></pre></div></li><li><p>使用 kubectl -h 查看各个命令的帮助，很多都在 Examples 里。比如 <code>kubectl expose -h</code>。</p></li></ul><div class=gdoc-page__anchorwrap><h2 id=cka-真题练习>CKA 真题练习<a data-clipboard-text=https://l10178.github.io/bits-pieces/kubernetes/cka/#cka-真题练习 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor CKA 真题练习" href=#cka-真题练习><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>真题会过时，别指望着刷刷题就通过考试，老老实实学一遍。</p><ol><li><p>将所有 pv 按照 name/capacity 排序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go> # sort by name
</span></span></span><span class=line><span class=cl><span class=go> kubectl get pv --sort-by=.metadata.name
</span></span></span><span class=line><span class=cl><span class=go> # sort by capacity
</span></span></span><span class=line><span class=cl><span class=go> kubectl get pv --sort-by=.spec.capacity.storage
</span></span></span></code></pre></div></li><li><p>deployment 扩容。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go> kubectl scale deployment test --replicas=3
</span></span></span></code></pre></div></li><li><p>Set the node named ek8s-node-1 as unavaliable and reschedule all the pods running on it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go> kubectl cordon ek8s-node-1
</span></span></span><span class=line><span class=cl><span class=go> # drain node的时候可能出错，根据错误提示加参数
</span></span></span><span class=line><span class=cl><span class=go> kubectl drain ek8s-node-1 --delete-local-data --ignore-daemonsets --force
</span></span></span></code></pre></div></li><li><p>Form the pod label name-cpu-loader,find pods running high CPU workloads and write the name of the pod consuming most CPU to the file <code>/opt/KUTR00401/KURT00401.txt</code>(which alredy exists).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go> # 注意题目中并没有提namespace，可以先看下这个label的pod在哪个namespace，确定命令中要不要加namespace
</span></span></span><span class=line><span class=cl><span class=go> kubectl top pods -l name=name-cpu-loader --sort-by=cpu
</span></span></span><span class=line><span class=cl><span class=go> echo &#39;排名第一的pod名称&#39; &gt;&gt;/opt/KUTR00401/KUTR00401.txt
</span></span></span></code></pre></div></li></ol></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><div class="container flex flex-wrap"><span class=gdoc-footer__item>Copyright © 2020-2022 <a href=https://www.nxest.com class=gdoc-footer__link>nxest.com</a>.</span></div></footer></div><script defer src=/bits-pieces/js/en.search.min.js></script>
<script defer src=/bits-pieces/js/clipboard.min.js></script>
<script>document.addEventListener("DOMContentLoaded",function(){var t=new ClipboardJS(".clip")})</script></body></html>