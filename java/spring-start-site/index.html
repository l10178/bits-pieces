<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring Start脚手架快速入门 | bits-pieces</title><link rel=icon href=/bits-pieces/favicon/favicon-32x32.png type=image/x-icon><link rel=stylesheet href=/bits-pieces/main.min.css media=screen><link rel=stylesheet href=/bits-pieces/custom.css media=screen><link rel=alternate type=application/rss+xml href=https://l10178.github.io/bits-pieces/java/spring-start-site/index.xml title=bits-pieces></head><body><div class=wrapper><input type=checkbox class=hidden id=menu-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control><svg class="icon menu"><use xlink:href="#menu"/></svg><svg class="icon arrow-back"><use xlink:href="#arrow_back"/></svg></label><a class=gdoc-header__link href=https://l10178.github.io/bits-pieces/><span class="gdoc-brand flex align-center"><img class=gdoc-brand__img src=/bits-pieces/images/logos/logo.png alt=bits-pieces width=38 height=38>
bits-pieces</span></a></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class=gdoc-search><svg class="icon search"><use xlink:href="#search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/ class=gdoc-nav__entry>DevOps</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/mysql5.7to8.0/ class=gdoc-nav__entry>MySQL5.7升级至8.0</a></span></li><li><span class=flex><a href=/bits-pieces/devops/mysql-large-import/ class=gdoc-nav__entry>MySQL大文件导入优化</a></span></li><li><span class=flex><a href=/bits-pieces/devops/nexus/ class=gdoc-nav__entry>Nexus3 批量导入</a></span></li><li><span class=flex><a href=/bits-pieces/devops/superset/ class=gdoc-nav__entry>Superset 对接 ClickHouse</a></span></li><li><span class=flex><a href=/bits-pieces/devops/cdr/ class=gdoc-nav__entry>使用Visual Studio Code搭建多用户远程IDE</a></span></li></ul></li><li><span class=flex>Javas</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/java/jvm/ class=gdoc-nav__entry>Java进程内存分析</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-start-site/ class="gdoc-nav__entry is-active">Spring Start脚手架快速入门</a></span></li></ul></li><li><span class=flex>Kubernetes</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/kubernetes/envoy/ class=gdoc-nav__entry>Envoy生产配置最佳实践</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/cka/ class=gdoc-nav__entry>备考 CKA 过程，CKA 真题</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/linux/ class=gdoc-nav__entry>Linux</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/linux/regular-expressions/ class=gdoc-nav__entry>Regular Expressions</a></span></li><li><span class=flex><a href=/bits-pieces/linux/history/ class=gdoc-nav__entry>History入门</a></span></li><li><span class=flex><a href=/bits-pieces/linux/pngquant/ class=gdoc-nav__entry>PNG图片批量压缩</a></span></li><li><span class=flex><a href=/bits-pieces/linux/shell-coding/ class=gdoc-nav__entry>Shell 编程实用句式</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tcpdump/ class=gdoc-nav__entry>tcpdump</a></span></li><li><span class=flex><a href=/bits-pieces/linux/transaction/ class=gdoc-nav__entry>数据库事务控制</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tar.gz/ class=gdoc-nav__entry>文件压缩解压</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/windows/ class=gdoc-nav__entry>Windows</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/windows/takeown/ class=gdoc-nav__entry>Windows提权 + 设置环境变量</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/knives/ class=gdoc-nav__entry>瑞士军刀</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/knives/ripgrep/ class=gdoc-nav__entry>ripgrep</a></span></li><li><span class=flex><a href=/bits-pieces/knives/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li></ul></li></ul></section><section class=gdoc-nav--more><h2>More</h2><ul class=gdoc-nav__list><li><span class=flex><svg class="icon download"><use xlink:href="#download"/></svg><a href=https://github.com/l10178/bits-pieces/releases class=gdoc-nav__entry>Releases</a></span></li><li><span class=flex><svg class="icon github"><use xlink:href="#github"/></svg><a href=https://github.com/l10178/bits-pieces class=gdoc-nav__entry>View Source</a></span></li></ul></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype=https://schema.org/Breadcrumb><span></span><span><svg class="icon code"><use xlink:href="#code"/></svg><a href=https://github.com/l10178/bits-pieces/edit/main/content/java/spring-start-site/_index.md>Edit this page</a></span></div><article class=gdoc-markdown><h1>Spring Start脚手架快速入门</h1><p>基于 <code>start.spring.io</code> 快速定制自己的脚手架，主要应用场景：</p><ol><li>规范公司自己的 parent pom，增加特定的依赖项。</li><li>根据公司规范生成统一的包结构，统一命名。</li><li>根据约束增加特定代码或文件，比如根据公司要求统一 logback.xml 文件。</li></ol><p>这篇文章的目的是如何快速开始，原理和详细配置官方文档已经很详细了。</p><div class=gdoc-page__anchorwrap><h2 id=快速开始>快速开始<a data-clipboard-text=https://l10178.github.io/bits-pieces/java/spring-start-site/#快速开始 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 快速开始" href=#快速开始><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>基本步骤：</p><ol><li>对于 <a href=https://github.com/spring-io/initializr>spring.initializr</a> 我们没有定制的需求，直接引用官方的。</li><li>拷贝一份 <a href=https://github.com/spring-io/start.spring.io>start.spring.io</a>，直接基于这个项目开发、部署、运行。以下都是关于如何修改 <code>start.spring.io</code>。</li></ol><p><code>start.spring.io</code> 主要关注两个模块：</p><ul><li>start-client：前端页面，可以定制些自己的 logo、title 等。</li><li>start-site：是一个标准的 spring boot 项目，实际 run 起来的服务，引用了 start-client，直接 run 这个项目的 main 方法就能看到效果。</li></ul><p>主要配置文件：<code>start-site/src/main/resources/application.yml</code>，通过修改这个配置文件可以达到的效果如下。</p><ul><li><p>修改 start 启动时默认 group，把 <code>com.example</code> 改为公司自己的 group。</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>initializr</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>group-id</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=l>com.yourgroup</span><span class=w>
</span></code></pre></div></li><li><p>修改父 pom，使用公司自己的 pom。</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>initializr</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>maven</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=c># use your parent pom</span><span class=w>
</span><span class=w>      </span><span class=nt>parent</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>groupId</span><span class=p>:</span><span class=w> </span><span class=l>com.yourself</span><span class=w>
</span><span class=w>        </span><span class=nt>artifactId</span><span class=p>:</span><span class=w> </span><span class=l>your-parent</span><span class=w>
</span><span class=w>        </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=m>1.0.0</span><span class=w>
</span><span class=w>        </span><span class=c># relativePath: ../pom.xml</span><span class=w>
</span><span class=w>        </span><span class=nt>includeSpringBootBom</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></code></pre></div></li><li><p>限定 Java 和 Spring Boot 版：修改 languages 和 bootVersions 即可。</p></li><li><p>增加公司自己的 starter，参考文件中例子增加即可。</p></li></ul><div class=gdoc-page__anchorwrap><h2 id=核心扩展接口>核心扩展接口<a data-clipboard-text=https://l10178.github.io/bits-pieces/java/spring-start-site/#核心扩展接口 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 核心扩展接口" href=#核心扩展接口><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><ul><li>ProjectContributor: 用于实现文件结构变化，比如加个文件夹，增加配置文件、代码片段等。</li><li>BuildCustomizer：动态修改 pom.xml，用于修改 maven/gradle 的 dependencies/repository/plugins 等。</li><li>更多自带定制接口参考：MainSourceCodeCustomizer, MainCompilationUnitCustomizer, MainApplicationTypeCustomizer, TestSourceCodeCustomizer, TestApplicationTypeCustomizer.</li></ul><p>场景：生成默认的 logback-spring.xml。</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kn>import</span> <span class=nn>io.spring.initializr.generator.project.contributor.SingleResourceProjectContributor</span><span class=o>;</span>

<span class=cm>/**
</span><span class=cm> * 定制 logback xml文件，从当前项目的`classpath:configuration`拷贝到指定的src/main/resources目录下
</span><span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LogbackContributor</span> <span class=kd>extends</span> <span class=n>SingleResourceProjectContributor</span> <span class=o>{</span>

  <span class=kd>public</span> <span class=nf>LogbackContributor</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>this</span><span class=o>(</span><span class=s>&#34;classpath:configuration/logback-spring.xml&#34;</span><span class=o>);</span>
  <span class=o>}</span>

  <span class=kd>public</span> <span class=nf>LogbackContributor</span><span class=o>(</span><span class=n>String</span> <span class=n>resourcePattern</span><span class=o>)</span> <span class=o>{</span>
    <span class=kd>super</span><span class=o>(</span><span class=s>&#34;src/main/resources/logback-spring.xml&#34;</span><span class=o>,</span> <span class=n>resourcePattern</span><span class=o>);</span>
  <span class=o>}</span>

<span class=o>}</span>
</code></pre></div><p>场景：按照统一规范生成目录结构。</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java>
<span class=cm>/**
</span><span class=cm> * 按照规范生成默认的java目录结构
</span><span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultPackageContributor</span> <span class=kd>implements</span> <span class=n>ProjectContributor</span> <span class=o>{</span>

  <span class=kd>private</span> <span class=kd>final</span> <span class=n>ProjectDescription</span> <span class=n>description</span><span class=o>;</span>

  <span class=kd>public</span> <span class=nf>DefaultPackageContributor</span><span class=o>(</span><span class=n>ProjectDescription</span> <span class=n>description</span><span class=o>)</span> <span class=o>{</span>
    <span class=k>this</span><span class=o>.</span><span class=na>description</span> <span class=o>=</span> <span class=n>description</span><span class=o>;</span>
  <span class=o>}</span>


  <span class=nd>@Override</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>contribute</span><span class=o>(</span><span class=n>Path</span> <span class=n>projectRoot</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=o>{</span>
    <span class=n>Language</span> <span class=n>language</span> <span class=o>=</span> <span class=n>description</span><span class=o>.</span><span class=na>getLanguage</span><span class=o>();</span>
    <span class=c1>// &#34;src/main/java/com.test.demo&#34;
</span><span class=c1></span>    <span class=n>Path</span> <span class=n>packageRoot</span> <span class=o>=</span> <span class=n>projectRoot</span><span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=s>&#34;src/main/&#34;</span><span class=o>)</span>
        <span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=n>language</span><span class=o>.</span><span class=na>id</span><span class=o>())</span>
        <span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=n>description</span><span class=o>.</span><span class=na>getPackageName</span><span class=o>().</span><span class=na>replaceAll</span><span class=o>(</span><span class=s>&#34;\\.&#34;</span><span class=o>,</span><span class=s>&#34;/&#34;</span><span class=o>));</span>
    <span class=n>Files</span><span class=o>.</span><span class=na>createDirectories</span><span class=o>(</span><span class=n>packageRoot</span><span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=s>&#34;config&#34;</span><span class=o>));</span>
    <span class=n>Files</span><span class=o>.</span><span class=na>createDirectories</span><span class=o>(</span><span class=n>packageRoot</span><span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=s>&#34;dao&#34;</span><span class=o>));</span>
    <span class=n>Files</span><span class=o>.</span><span class=na>createDirectories</span><span class=o>(</span><span class=n>packageRoot</span><span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=s>&#34;service&#34;</span><span class=o>));</span>
    <span class=n>Files</span><span class=o>.</span><span class=na>createDirectories</span><span class=o>(</span><span class=n>packageRoot</span><span class=o>.</span><span class=na>resolve</span><span class=o>(</span><span class=s>&#34;web&#34;</span><span class=o>));</span>
  <span class=o>}</span>
<span class=o>}</span>

</code></pre></div><p>场景：在 xxx 条件下做 xxx。比如我们使用 spock 作为测试框架，spock 使用 groovy 语言。如果引入 spock 的时候，默认在 maven plugin 里增加 groovy 插件 <code>gmavenplus-plugin</code>。</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java>
<span class=kd>class</span> <span class=nc>SpockMavenBuildCustomizer</span> <span class=kd>implements</span> <span class=n>BuildCustomizer</span><span class=o>&lt;</span><span class=n>MavenBuild</span><span class=o>&gt;</span> <span class=o>{</span>

  <span class=nd>@Override</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>customize</span><span class=o>(</span><span class=n>MavenBuild</span> <span class=n>build</span><span class=o>)</span> <span class=o>{</span>
    <span class=c1>// add groovy plugin
</span><span class=c1></span>    <span class=n>build</span><span class=o>.</span><span class=na>plugins</span><span class=o>()</span>
        <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;org.codehaus.gmavenplus&#34;</span><span class=o>,</span> <span class=s>&#34;gmavenplus-plugin&#34;</span><span class=o>);</span>
  <span class=o>}</span>
<span class=o>}</span>

</code></pre></div><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@ProjectGenerationConfiguration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyProjectGenerationConfiguration</span> <span class=o>{</span>

  <span class=nd>@Bean</span>
  <span class=nd>@ConditionalOnRequestedDependency</span><span class=o>(</span><span class=s>&#34;spock&#34;</span><span class=o>)</span>
  <span class=kd>public</span> <span class=n>SpockMavenBuildCustomizer</span> <span class=nf>spockMavenBuildCustomizer</span><span class=o>()</span> <span class=o>{</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>SpockMavenBuildCustomizer</span><span class=o>();</span>
  <span class=o>}</span>

<span class=o>}</span>
</code></pre></div></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><div class="container flex flex-wrap"><span class=gdoc-footer__item>Copyright © 2020-2022 <a href=https://www.nxest.com class=gdoc-footer__link>nxest.com</a>.</span></div></footer></div><script defer src=/bits-pieces/js/en.search.min.js></script><script defer src=/bits-pieces/js/clipboard.min.js></script><script>document.addEventListener("DOMContentLoaded",function(event){var clipboard=new ClipboardJS('.clip');});</script></body></html>