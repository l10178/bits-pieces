<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>MySQL5.7升级至8.0 | bits-pieces</title><link rel=icon href=/bits-pieces/favicon/favicon-32x32.png type=image/x-icon><link rel=stylesheet href=/bits-pieces/main.min.css media=screen><link rel=stylesheet href=/bits-pieces/custom.css media=screen></head><body><div class=wrapper><input type=checkbox class=hidden id=menu-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control><svg class="icon menu"><use xlink:href="#menu"/></svg><svg class="icon arrow-back"><use xlink:href="#arrow_back"/></svg></label><a class=gdoc-header__link href=https://l10178.github.io/bits-pieces/><span class="gdoc-brand flex align-center"><img class=gdoc-brand__img src=/bits-pieces/images/logos/logo.png alt=bits-pieces width=38 height=38>
bits-pieces</span></a></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class=gdoc-search><svg class="icon search"><use xlink:href="#search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/ class=gdoc-nav__entry>DevOps</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/mysql5.7to8.0/ class="gdoc-nav__entry is-active">MySQL5.7升级至8.0</a></span></li><li><span class=flex><a href=/bits-pieces/devops/mysql-large-import/ class=gdoc-nav__entry>MySQL大文件导入优化</a></span></li><li><span class=flex><a href=/bits-pieces/devops/nexus/ class=gdoc-nav__entry>Nexus3 批量导入</a></span></li><li><span class=flex><a href=/bits-pieces/devops/superset/ class=gdoc-nav__entry>Superset 对接 ClickHouse</a></span></li><li><span class=flex><a href=/bits-pieces/devops/cdr/ class=gdoc-nav__entry>使用Visual Studio Code搭建多用户远程IDE</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/java/ class=gdoc-nav__entry>Java</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/java/jvm/ class=gdoc-nav__entry>Java进程内存分析</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-start-site/ class=gdoc-nav__entry>Spring Start脚手架快速入门</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-boot/ class=gdoc-nav__entry>从Spring到Spring Boot</a></span></li></ul></li><li><span class=flex>Kubernetes</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/kubernetes/envoy/ class=gdoc-nav__entry>Envoy生产配置最佳实践</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/cka/ class=gdoc-nav__entry>备考 CKA 过程，CKA 真题</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/linux/ class=gdoc-nav__entry>Linux</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/linux/regular-expressions/ class=gdoc-nav__entry>Regular Expressions</a></span></li><li><span class=flex><a href=/bits-pieces/linux/git/ class=gdoc-nav__entry>Git常用配置</a></span></li><li><span class=flex><a href=/bits-pieces/linux/history/ class=gdoc-nav__entry>History入门</a></span></li><li><span class=flex><a href=/bits-pieces/linux/pngquant/ class=gdoc-nav__entry>PNG图片批量压缩</a></span></li><li><span class=flex><a href=/bits-pieces/linux/shell-coding/ class=gdoc-nav__entry>Shell 编程实用句式</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tcpdump/ class=gdoc-nav__entry>tcpdump</a></span></li><li><span class=flex><a href=/bits-pieces/linux/transaction/ class=gdoc-nav__entry>数据库事务控制</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tar.gz/ class=gdoc-nav__entry>文件压缩解压</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/windows/ class=gdoc-nav__entry>Windows</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/windows/takeown/ class=gdoc-nav__entry>Windows提权 + 设置环境变量</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/knives/ class=gdoc-nav__entry>瑞士军刀</a></span></li></ul></section><section class=gdoc-nav--more><h2>More</h2><ul class=gdoc-nav__list><li><span class=flex><svg class="icon download"><use xlink:href="#download"/></svg><a href=https://github.com/l10178/bits-pieces/releases class=gdoc-nav__entry>Releases</a></span></li><li><span class=flex><svg class="icon github"><use xlink:href="#github"/></svg><a href=https://github.com/l10178/bits-pieces class=gdoc-nav__entry>View Source</a></span></li></ul></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype=https://schema.org/Breadcrumb><span></span><span><svg class="icon code"><use xlink:href="#code"/></svg><a href=https://github.com/l10178/bits-pieces/edit/main/content/devops/mysql5.7to8.0.md>Edit this page</a></span></div><article class=gdoc-markdown><h1>MySQL5.7升级至8.0</h1><p>MySQL 5.7 升级至 8.0，程序适配以及踩坑记录。</p><div class=gdoc-page__anchorwrap><h2 id=代码适配方案>代码适配方案<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/mysql5.7to8.0/#代码适配方案 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 代码适配方案" href=#代码适配方案><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><ol><li>mysql-connector-java.jar 升级到 8.0.21 版本。</li><li>com.mysql.jdbc.Driver 更换为 com.mysql.cj.jdbc.Driver。</li><li>链接 url 里指定 useSSL=false。</li><li>链接 url 中显式指定时区，增加 serverTimezone=Asia/Shanghai。</li></ol><div class=gdoc-page__anchorwrap><h2 id=兼容性问题>兼容性问题<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/mysql5.7to8.0/#兼容性问题 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 兼容性问题" href=#兼容性问题><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><ol><li><p><code>com.mysql.jdbc.exceptions.jdbc4</code> 在 MySQL Connector 8 中不存在。</p><p>将 mysql-connector-java 版本，升级到 8.0 后，如果项目中有使用 mysql 的 Exception 类，编译时会收到以下错误</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>error: package com.mysql.jdbc.exceptions.jdbc4 does not exist
</span></span></span><span class=line><span class=cl><span class=go>[ERROR] import com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException;
</span></span></span><span class=line><span class=cl><span class=go>[ERROR] import com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException;
</span></span></span></code></pre></div><p>MySQL 在 8.0 版本重用了现有的 java.sql 异常类，取消了 exceptions.jdbc4 的异常类，整改的异常映射关系如下。</p><table><thead><tr><th>5.7 版本异常类</th><th>8.0 版本异常类</th></tr></thead><tbody><tr><td>com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException</td><td>java.sql.SQLSyntaxErrorException</td></tr><tr><td>com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException</td><td>java.sql.SQLIntegrityConstraintViolationException</td></tr><tr><td>com.mysql.jdbc.exceptions.jdbc4.MySQLTransactionRollbackException</td><td>java.sql.SQLTransactionRollbackException</td></tr></tbody></table></li><li><p>数据库关键字扩充问题。</p><p>在适配 MySQL 8.0 的时候遇到如下报错。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>Caused by: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;, source, i18n_lang&#39; at line 5
</span></span></span></code></pre></div><p>问题的原因是：MySQL 新增了一批关键字，在使用过程中，如果字段名称和关键字重复，则需要在字段名称上增加单引号方可使用。RANK 为新增关键字。如下所示：</p><pre tabindex=0><code class=language-xmll data-lang=xmll>&lt;result column=&#34;rank&#34; jdbcType=&#34;INTEGER&#34; property=&#34;rank&#34;/&gt;
</code></pre><p>新增关键字列表如下。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=n>ACTIVE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ADMIN</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ARRAY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ATTRIBUTE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>BUCKETS</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>CLONE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>COMPONENT</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>CUME_DIST</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>DEFINITION</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>DENSE_RANK</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>DESCRIPTION</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>EMPTY</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ENFORCED</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ENGINE_ATTRIBUTE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>EXCEPT</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>EXCLUDE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>FAILED_LOGIN_ATTEMPTS</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>FIRST_VALUE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>FOLLOWING</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>GEOMCOLLECTION</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>GET_MASTER_PUBLIC_KEY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>GROUPING</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>GROUPS</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>HISTOGRAM</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>HISTORY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>INACTIVE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>INVISIBLE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>JSON_TABLE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>JSON_VALUE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>LAG</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>LAST_VALUE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>LATERAL</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>LEAD</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>LOCKED</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MANAGED</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MASTER_COMPRESSION_ALGORITH</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MSMASTER_PUBLIC_KEY_PATH</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MASTER_TLS_CIPHERSUITES</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MASTER_ZSTD_COMPRESSION_LEVEL</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>MEMBER</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>NESTED</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>NETWORK_NAMESPACE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>NOWAIT</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>NTH_VALUE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>NTILE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=no>NULL</span><span class=n>S</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>OF</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>OFF</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>OJ</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>OLD</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>OPTIONAL</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ORDINALITY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ORGANIZATION</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>OTHERS</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>OVER</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PASSWORD_LOCK_TIME</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PATH</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>PERCENT_RANK</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PERSIST</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PERSIST_ONLY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PRECEDING</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PRIVILEGE_CHECKS_USER</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>PROCESS</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RANDOM</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>RANK</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>RECURSIVE</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>REFERENCE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>REQUIRE_ROW_FORMAT</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RESOURCE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RESPECT</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RESTART</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RETAIN</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>RETURNING</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>REUSE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>ROLE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>ROW_NUMBER</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SECONDARY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SECONDARY_ENGINE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SECONDARY_ENGINE_ATTRIBUTE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SECONDARY_LOAD</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SECONDARY_UNLOAD</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SKIP</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>SRID</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>STREAM</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>SYSTEM</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>THREAD_PRIORITY</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>TIES</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>TLS</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>UNBOUNDED</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>VCPU</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=n>VISIBLE</span><span class=w>  </span><span class=p>,</span><span class=w>  </span><span class=nf>WINDOW</span><span class=w> </span><span class=p>(</span><span class=n>R</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div></li></ol></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><div class="container flex flex-wrap"><span class=gdoc-footer__item>Copyright © 2020-2022 <a href=https://www.nxest.com class=gdoc-footer__link>nxest.com</a>.</span></div></footer></div><script defer src=/bits-pieces/js/en.search.min.js></script>
<script defer src=/bits-pieces/js/clipboard.min.js></script>
<script>document.addEventListener("DOMContentLoaded",function(){var t=new ClipboardJS(".clip")})</script></body></html>