<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Nexus3 批量导入 | bits-pieces</title><link rel=icon href=/bits-pieces/favicon/favicon-32x32.png type=image/x-icon><link rel=stylesheet href=/bits-pieces/main.min.css media=screen><link rel=stylesheet href=/bits-pieces/custom.css media=screen><link rel=alternate type=application/rss+xml href=https://l10178.github.io/bits-pieces/devops/nexus/index.xml title=bits-pieces></head><body><div class=wrapper><input type=checkbox class=hidden id=menu-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control><svg class="icon menu"><use xlink:href="#menu"/></svg><svg class="icon arrow-back"><use xlink:href="#arrow_back"/></svg></label><a class=gdoc-header__link href=https://l10178.github.io/bits-pieces/><span class="gdoc-brand flex align-center"><img class=gdoc-brand__img src=/bits-pieces/images/logos/logo.png alt=bits-pieces width=38 height=38>
bits-pieces</span></a></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class=gdoc-search><svg class="icon search"><use xlink:href="#search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/ class=gdoc-nav__entry>DevOps</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/mysql5.7to8.0/ class=gdoc-nav__entry>MySQL5.7升级至8.0</a></span></li><li><span class=flex><a href=/bits-pieces/devops/mysql-large-import/ class=gdoc-nav__entry>MySQL大文件导入优化</a></span></li><li><span class=flex><a href=/bits-pieces/devops/nexus/ class="gdoc-nav__entry is-active">Nexus3 批量导入</a></span></li><li><span class=flex><a href=/bits-pieces/devops/superset/ class=gdoc-nav__entry>Superset 对接 ClickHouse</a></span></li><li><span class=flex><a href=/bits-pieces/devops/cdr/ class=gdoc-nav__entry>使用Visual Studio Code搭建多用户远程IDE</a></span></li></ul></li><li><span class=flex>Javas</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/java/jvm/ class=gdoc-nav__entry>Java进程内存分析</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring-start-site/ class=gdoc-nav__entry>Spring Start脚手架快速入门</a></span></li><li><span class=flex><a href=/bits-pieces/java/spring/ class=gdoc-nav__entry>从Spring到Spring Cloud迁移升级</a></span></li></ul></li><li><span class=flex>Kubernetes</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/kubernetes/envoy/ class=gdoc-nav__entry>Envoy生产配置最佳实践</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/cka/ class=gdoc-nav__entry>备考 CKA 过程，CKA 真题</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/linux/ class=gdoc-nav__entry>Linux</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/linux/regular-expressions/ class=gdoc-nav__entry>Regular Expressions</a></span></li><li><span class=flex><a href=/bits-pieces/linux/git/ class=gdoc-nav__entry>Git常用配置</a></span></li><li><span class=flex><a href=/bits-pieces/linux/history/ class=gdoc-nav__entry>History入门</a></span></li><li><span class=flex><a href=/bits-pieces/linux/pngquant/ class=gdoc-nav__entry>PNG图片批量压缩</a></span></li><li><span class=flex><a href=/bits-pieces/linux/shell-coding/ class=gdoc-nav__entry>Shell 编程实用句式</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tcpdump/ class=gdoc-nav__entry>tcpdump</a></span></li><li><span class=flex><a href=/bits-pieces/linux/transaction/ class=gdoc-nav__entry>数据库事务控制</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tar.gz/ class=gdoc-nav__entry>文件压缩解压</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/windows/ class=gdoc-nav__entry>Windows</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/windows/takeown/ class=gdoc-nav__entry>Windows提权 + 设置环境变量</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/knives/ class=gdoc-nav__entry>瑞士军刀</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/knives/ripgrep/ class=gdoc-nav__entry>ripgrep</a></span></li><li><span class=flex><a href=/bits-pieces/knives/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li></ul></li></ul></section><section class=gdoc-nav--more><h2>More</h2><ul class=gdoc-nav__list><li><span class=flex><svg class="icon download"><use xlink:href="#download"/></svg><a href=https://github.com/l10178/bits-pieces/releases class=gdoc-nav__entry>Releases</a></span></li><li><span class=flex><svg class="icon github"><use xlink:href="#github"/></svg><a href=https://github.com/l10178/bits-pieces class=gdoc-nav__entry>View Source</a></span></li></ul></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype=https://schema.org/Breadcrumb><span></span><span><svg class="icon code"><use xlink:href="#code"/></svg><a href=https://github.com/l10178/bits-pieces/edit/main/content/devops/nexus/_index.md>Edit this page</a></span></div><article class=gdoc-markdown><h1>Nexus3 批量导入</h1><p>应用场景：</p><ol><li>从一个可联网镜像仓库迁移到另一个无法联网的镜像仓库，涉及 Java 和 JavaScript 依赖包。</li><li>源镜像仓库比较大（10T），新镜像仓库只需要部分依赖，不需要全量导入。</li></ol><div class=gdoc-page__anchorwrap><h2 id=nexus-配置-repository>Nexus 配置 Repository<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/nexus/#nexus-配置-repository class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor Nexus 配置 Repository" href=#nexus-配置-repository><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>在 nexus 上创建 Java 和 NPM Repository。</p><p>注意：</p><ol><li>创建时类型选择 hosted。</li><li>对于 Java Repository 可根据实际情况将 Version Policy 选择 mixed。</li><li>Deployment Policy 选择 Allow redeploy，便于后续重复导入。</li></ol><div class=gdoc-page__anchorwrap><h2 id=导入-java-依赖包>导入 Java 依赖包<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/nexus/#导入-java-依赖包 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 导入 Java 依赖包" href=#导入-java-依赖包><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><ol><li><p>准备 Java 依赖包：将本地 maven 或 gradle 的存储目录(默认$USER/.m2/repository)清空，重新执行命令，获取干净的 repository。</p></li><li><p>从 <a href=https://github.com/sonatype-nexus-community/nexus-repository-import-scripts>nexus-repository-import-scripts</a> 获取 mavenimport.sh 文件。</p></li><li><p>将 mavenimport.sh copy 到 repository 文件夹内</p></li><li><p>执行以下命令开始导入，注意换成自己的 admin 密码，修改端口和 Repository。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>  <span class=nb>cd</span> repository <span class=o>&amp;&amp;</span> chmod +x mavenimport.sh
  ./mavenimport.sh -u admin -p admin123 -r http://127.0.0.1:8081/repository/your-repo-name/
</code></pre></div></li><li><p>以上命令开始导入，可能时间较长，可以去界面上刷新下 jdf 的 repository 看看有没有导进去。</p></li></ol><div class=gdoc-page__anchorwrap><h2 id=导入-npm-依赖包>导入 NPM 依赖包<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/nexus/#导入-npm-依赖包 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 导入 NPM 依赖包" href=#导入-npm-依赖包><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>导入前端 npm 包就是先下载好各个包的 tgz 文件，然后根据 tgz 文件执行 npm publish。</p><ol><li><p>准备前端依赖包：使用这个工具 <a href=https://github.com/Meir017/node-tgz-downloader>node-tgz-downloader</a>，根据他的说明，先下载好各个 js 的 <code>.tgz</code>文件，默认下载到一个叫 tarballs 的文件夹内，下载成功后大致结果如下，如果 nodejs 版本比较低可能下载失败，可以尝试使用低版本的 node-tgz-downloader。</p><pre><code class=language-console data-lang=console>tarballs
├── @babel
│   ├── code-frame
│   │   ├── code-frame-7.12.11.tgz
│   │   └── code-frame-7.16.0.tgz
│   ├── compat-data
│   │   └── compat-data-7.16.4.tgz
│   ├── core
│   │   └── core-7.16.0.tgz
│   ├── generator
│   │   └── generator-7.16.0.tgz
│   ├── helper-annotate-as-pure
│   │   └── helper-annotate-as-pure-7.16.0.tgz
</code></pre></li><li><p>从 <a href=https://github.com/sonatype-nexus-community/nexus-repository-import-scripts>nexus-repository-import-scripts</a> 获取 npmimport.sh 文件。</p></li><li><p>将 npmimport.sh copy 到 tarballs 文件夹内。</p></li><li><p>登录 npm 账户，开始执行导入。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash> npm config <span class=nb>set</span> <span class=nv>registry</span><span class=o>=</span>http://127.0.0.1:8081/repository/your-npm-repo/
 npm adduser --registry<span class=o>=</span>http://127.0.0.1:8081/repository/your-npm-repo/
 <span class=nb>cd</span> tarballs <span class=o>&amp;&amp;</span> chmod +x npmimport.sh
 ./npmimport.sh -r http://127.0.0.1:8081/repository/your-npm-repo/
</code></pre></div></li><li><p>以上命令开始导入，可能时间较长，可以去界面上刷新下 npm 的 repository 看看有没有导进去。</p></li></ol><div class=gdoc-page__anchorwrap><h2 id=客户端使用>客户端使用<a data-clipboard-text=https://l10178.github.io/bits-pieces/devops/nexus/#客户端使用 class="gdoc-page__anchor gdoc-page__anchor--right clip" aria-label="Anchor 客户端使用" href=#客户端使用><svg class="icon link"><use xlink:href="#link"/></svg></a></h2></div><p>Maven 修改 setting.xml，使用私有仓库。</p><p>另外因为部分包不受自己控制，可能缺少 metadata，执行 <code>mvn package</code> 等命令时，注意增加 <code>-c</code> 参数忽略 checksum。</p><p>如：<code>mvn -c clean package -Dmaven.test.skip=true</code></p></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><div class="container flex flex-wrap"><span class=gdoc-footer__item>Copyright © 2020-2022 <a href=https://www.nxest.com class=gdoc-footer__link>nxest.com</a>.</span></div></footer></div><script defer src=/bits-pieces/js/en.search.min.js></script><script defer src=/bits-pieces/js/clipboard.min.js></script><script>document.addEventListener("DOMContentLoaded",function(event){var clipboard=new ClipboardJS('.clip');});</script></body></html>