<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Shell 编程实用句式 | bits-pieces</title><link rel=icon href=/bits-pieces/favicon/favicon-32x32.png type=image/x-icon><link rel=stylesheet href=/bits-pieces/main.min.css media=screen><link rel=stylesheet href=/bits-pieces/custom.css media=screen></head><body><div class=wrapper><input type=checkbox class=hidden id=menu-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control><svg class="icon menu"><use xlink:href="#menu"/></svg><svg class="icon arrow-back"><use xlink:href="#arrow_back"/></svg></label><a class=gdoc-header__link href=https://l10178.github.io/bits-pieces/><span class="gdoc-brand flex align-center"><img class=gdoc-brand__img src=/bits-pieces/images/logos/logo.png alt=bits-pieces width=38 height=38>
bits-pieces</span></a></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class=gdoc-search><svg class="icon search"><use xlink:href="#search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search... aria-label=Search maxlength=64><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/ class=gdoc-nav__entry>DevOps</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/devops/mysql5.7to8.0/ class=gdoc-nav__entry>MySQL5.7升级至8.0</a></span></li><li><span class=flex><a href=/bits-pieces/devops/mysql-large-import/ class=gdoc-nav__entry>MySQL大文件导入优化</a></span></li><li><span class=flex><a href=/bits-pieces/devops/nexus/ class=gdoc-nav__entry>Nexus3 批量导入</a></span></li><li><span class=flex><a href=/bits-pieces/devops/superset/ class=gdoc-nav__entry>Superset 对接 ClickHouse</a></span></li><li><span class=flex><a href=/bits-pieces/devops/cdr/ class=gdoc-nav__entry>使用Visual Studio Code搭建多用户远程IDE</a></span></li></ul></li><li><span class=flex>Kubernetes</span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/kubernetes/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li><li><span class=flex><a href=/bits-pieces/kubernetes/cka/ class=gdoc-nav__entry>备考 CKA 过程，CKA 真题</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/linux/ class=gdoc-nav__entry>Linux</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/linux/regular-expressions/ class=gdoc-nav__entry>Regular Expressions</a></span></li><li><span class=flex><a href=/bits-pieces/linux/history/ class=gdoc-nav__entry>History入门</a></span></li><li><span class=flex><a href=/bits-pieces/linux/pngquant/ class=gdoc-nav__entry>PNG图片批量压缩</a></span></li><li><span class=flex><a href=/bits-pieces/linux/shell-coding/ class="gdoc-nav__entry is-active">Shell 编程实用句式</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tcpdump/ class=gdoc-nav__entry>tcpdump</a></span></li><li><span class=flex><a href=/bits-pieces/linux/transaction/ class=gdoc-nav__entry>数据库事务控制</a></span></li><li><span class=flex><a href=/bits-pieces/linux/tar.gz/ class=gdoc-nav__entry>文件压缩解压</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/windows/ class=gdoc-nav__entry>Windows</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/windows/takeown/ class=gdoc-nav__entry>Windows提权 + 设置环境变量</a></span></li></ul></li><li><span class=flex><a href=/bits-pieces/knives/ class=gdoc-nav__entry>瑞士军刀</a></span><ul class=gdoc-nav__list><li><span class=flex><a href=/bits-pieces/knives/ripgrep/ class=gdoc-nav__entry>ripgrep</a></span></li><li><span class=flex><a href=/bits-pieces/knives/tldr/ class=gdoc-nav__entry>TL;DR</a></span></li></ul></li></ul></section><section class=gdoc-nav--more><h2>More</h2><ul class=gdoc-nav__list><li><span class=flex><svg class="icon download"><use xlink:href="#download"/></svg><a href=https://github.com/l10178/bits-pieces/releases class=gdoc-nav__entry>Releases</a></span></li><li><span class=flex><svg class="icon github"><use xlink:href="#github"/></svg><a href=https://github.com/l10178/bits-pieces class=gdoc-nav__entry>View Source</a></span></li></ul></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap justify-between" itemscope itemtype=https://schema.org/Breadcrumb><span></span><span><svg class="icon code"><use xlink:href="#code"/></svg><a href=https://github.com/l10178/bits-pieces/edit/main/content/linux/shell-coding.md>Edit this page</a></span></div><article class=gdoc-markdown><h1>Shell 编程实用句式</h1><p>选婿。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1>#!/usr/bin/bash</span>
</code></pre></div><p>检查是否以 root 用户执行。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># check if run as root user</span>
<span class=k>if</span> <span class=o>[[</span> <span class=sb>`</span>id -u<span class=sb>`</span> -ne <span class=m>0</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
  <span class=nb>echo</span> <span class=s2>&#34;You need root privileges to run this script.&#34;</span>
<span class=k>fi</span>
</code></pre></div><p>获取正在执行脚本的绝对路径，注意直接用 $0 或 pwd 获取的可能都不要你想要的。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nv>current_dir</span><span class=o>=</span><span class=k>$(</span><span class=nb>cd</span> <span class=sb>`</span>dirname <span class=nv>$0</span><span class=sb>`</span><span class=p>;</span><span class=nb>pwd</span><span class=k>)</span>
</code></pre></div><p>为当前目录包含子目录下所有 .sh 文件增加可执行权限。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>chmod +x <span class=sb>`</span>find . -name <span class=s1>&#39;*.sh&#39;</span><span class=sb>`</span>
</code></pre></div><p>将提示信息显示到终端（控制台），同时也写入到文件里。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nv>log_file</span><span class=o>=</span>/var/log/test.log
<span class=nb>echo</span> <span class=s2>&#34;This line will echo to console and also write to log file.&#34;</span> <span class=p>|</span> tee -a <span class=si>${</span><span class=nv>log_file</span><span class=si>}</span>
</code></pre></div><p>类似于 Java properties 中 key=value 形式的字符串，取 key 和 value 的值。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=nv>username_line</span><span class=o>=</span><span class=s2>&#34;username=test&#34;</span>
<span class=c1>#key is username</span>
<span class=nv>key</span><span class=o>=</span><span class=si>${</span><span class=nv>username_line</span><span class=p>%=*</span><span class=si>}</span>
<span class=c1>#val is test</span>
<span class=nv>val</span><span class=o>=</span><span class=si>${</span><span class=nv>username_line</span><span class=p>#*=</span><span class=si>}</span>
</code></pre></div><p>实现 trim 效果。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#trim string by echo</span>
<span class=nv>val_trim</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> -n <span class=si>${</span><span class=nv>val</span><span class=si>}</span><span class=k>)</span>
</code></pre></div><p>字体输出颜色及终端格式控制</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#字体色范围：30-37</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[30m 黑色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[31m 红色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[32m 绿色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[33m 黄色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[34m 蓝色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[35m 紫色字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[36m 天蓝字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[37m 白色字 \033[0m&#34;</span>
<span class=c1>#字背景颜色范围：40-47</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[40;37m 黑底白字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[41;30m 红底黑字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[42;34m 绿底蓝字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[43;34m 黄底蓝字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[44;30m 蓝底黑字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[45;30m 紫底黑字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[46;30m 天蓝底黑字 \033[0m&#34;</span>
<span class=nb>echo</span> -e <span class=s2>&#34;\033[47;34m 白底蓝字 \033[0m&#34;</span>
</code></pre></div></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><div class="container flex flex-wrap"><span class=gdoc-footer__item>Copyright © 2020-2022 <a href=https://www.nxest.com class=gdoc-footer__link>nxest.com</a>.</span></div></footer></div><script defer src=/bits-pieces/js/en.search.min.js></script><script defer src=/bits-pieces/js/clipboard.min.js></script><script>document.addEventListener("DOMContentLoaded",function(event){var clipboard=new ClipboardJS('.clip');});</script></body></html>